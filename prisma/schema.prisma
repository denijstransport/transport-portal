// prisma/schema.prisma
generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

/* =========================
   Enums
   ========================= */
enum Role {
  ADMIN
  PLANNER
  DRIVER
  CLIENT
}

enum DocType {
  CONTRACT
  CMR
  POD
  LICENSE
  OTHER
}

enum ShipmentStatus {
  DRAFT
  PLANNED
  IN_TRANSIT
  DELIVERED
  CANCELLED
}

/* =========================
   Modellen
   ========================= */
model User {
  id            String      @id @default(cuid())
  email         String      @unique
  passwordHash  String
  name          String
  role          Role
  phone         String?
  createdAt     DateTime    @default(now())
  updatedAt     DateTime    @updatedAt

  // 1:1 links
  driverProfile DriverProfile?
  client        Client?

  // Back-relations (benoemd voor duidelijkheid)
  shipmentsAsDriver Shipment[] @relation("UserToDriverShipments")
  documents         Document[] @relation("UserToOwnerDocuments")
}

model DriverProfile {
  id                 String       @id @default(cuid())
  userId             String       @unique
  user               User         @relation(fields: [userId], references: [id])
  licenseNumber      String?
  licenseValidUntil  DateTime?
  address            String?
  avatarUrl          String?
  emergencyContact   String?

  hourEntries        HourEntry[]
  documents          Document[]   @relation("DriverProfileToDocuments")
}

model Client {
  id         String     @id @default(cuid())
  userId     String     @unique
  user       User       @relation(fields: [userId], references: [id])
  company    String
  vatNumber  String?
  address    String?

  shipments  Shipment[]
}

model Vehicle {
  id           String      @id @default(cuid())
  plateNumber  String      @unique
  type         String
  active       Boolean     @default(true)

  // Back-relation naar Shipment (benoemd)
  shipments    Shipment[]  @relation("VehicleToShipment")
}

model Shipment {
  id              String          @id @default(cuid())

  // Klant (verplicht)
  clientId        String
  client          Client          @relation(fields: [clientId], references: [id])

  reference       String
  pickupAddress   String
  deliveryAddress String
  pickupAt        DateTime
  deliveryEta     DateTime?
  status          ShipmentStatus  @default(DRAFT)

  // Chauffeur (optioneel) - benoemde relatie naar User
  driverId        String?
  driver          User?           @relation("UserToDriverShipments", fields: [driverId], references: [id])

  // Voertuig (optioneel) - benoemde relatie naar Vehicle
  vehicleId       String?
  vehicle         Vehicle?        @relation("VehicleToShipment", fields: [vehicleId], references: [id])

  // Documenten (benoemde relation-naam)
  documents       Document[]      @relation("ShipmentToDocuments")

  createdAt       DateTime        @default(now())
  updatedAt       DateTime        @updatedAt
}

model Document {
  id           String         @id @default(cuid())

  // Eigenaar User (optioneel) - benoemde relatie
  ownerUserId  String?
  ownerUser    User?          @relation("UserToOwnerDocuments", fields: [ownerUserId], references: [id])

  // DriverProfile (optioneel) - benoemde relatie
  driverId     String?
  driver       DriverProfile? @relation("DriverProfileToDocuments", fields: [driverId], references: [id])

  // Shipment (optioneel) - benoemde relatie
  shipmentId   String?
  shipment     Shipment?      @relation("ShipmentToDocuments", fields: [shipmentId], references: [id])

  type         DocType
  title        String
  fileKey      String          // S3 key
  fileUrl      String          // (eventueel presigned/public URL)
  uploadedAt   DateTime        @default(now())
}

model HourEntry {
  id           String        @id @default(cuid())
  driverId     String
  driver       DriverProfile @relation(fields: [driverId], references: [id])
  date         DateTime
  startTime    DateTime
  endTime      DateTime
  breakMinutes Int           @default(0)
  notes        String?
  approved     Boolean       @default(false)
  createdAt    DateTime      @default(now())
}
